{"version":3,"file":"StateEmission.js","sourceRoot":"","sources":["../lib/StateEmission.ts"],"names":[],"mappings":"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","sourcesContent":["export class StateEmission implements StateEmission {\n  instant: Set<string | number>;\n  spread: Set<string | number>;\n\n  constructor(public compareAsBitwise?: boolean, instant: Set<string | number> = new Set<string | number>(),\n    spread: Set<string | number> = new Set<string | number>()) {\n    this.instant = instant;\n    this.spread = spread;\n  }\n\n  /**\n   * This function is to be called when `sequencer.subscribe.next()` emits an item.\n   *\n   * @param state An optional parameter that specifies to assert if this state is current in this\n   * moment of time.  If no value, a number will be returned representing all states.\n   *\n   * @param compareAsBitwise when make assertion using bitwise logic.\n   */\n  valueOf(state?: string | number, compareAsBitwise?: boolean): boolean | number {\n    let results: boolean | number;\n    if (state !== undefined) {\n      results = (this.getStateValues(state, compareAsBitwise) > 0);\n    } else {\n      results = this.getStateValues(-1, true);\n    }\n    return results;\n  }\n\n  /**\n   * Called in StateExpression when constructing a seqeunce.  Its called specifically when\n   * additional value is add to spread Set.\n   */\n  mapToSpread(value: Set<string | number>) {\n    let spr = new Set(this.spread);\n    for (var val of value) {\n      spr.add(val)\n    }\n    this.spread = spr;\n    return this.spread;\n  }\n\n  private getStateValues(state: string | number, compareAsBitwise?: boolean): number {\n    let useBitwiseCompare: boolean;\n\n    if (compareAsBitwise != undefined) {\n      useBitwiseCompare = compareAsBitwise;\n    }\n    else if (this.compareAsBitwise != undefined) {\n      useBitwiseCompare = this.compareAsBitwise;\n    }\n    else {\n      useBitwiseCompare = false;\n    }\n\n    if (useBitwiseCompare === false) {\n      // here returning numbers (1,0) and not boolean to conform to this method's return type\n      if (this.instant.has(state) === false) {\n        return (this.spread.has(state) ? 1 : 0);\n      } else {\n        return 1;\n      }\n    } else if (typeof state === 'string') {\n      throw \"valueOf() has been called with a string and flagged to use bitwise comparisons.\"\n    } else {\n      let total: number = 0;\n      this.instant.forEach((value: string | number) => {\n        if (typeof value === 'number') {\n          total += value;\n        }\n      }, total);\n\n      this.spread.forEach((value: string | number) => {\n        if (typeof value === 'number') {\n          total += value;\n        }\n      }, total);\n\n      if (state === -1) {\n        return total;\n      } else {\n        return ((total & state) === state) ? 1 : -1;\n      }\n    }\n  }\n}\n"]}